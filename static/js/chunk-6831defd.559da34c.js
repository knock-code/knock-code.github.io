(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6831defd"],{"13e5":function(e,t,s){},"1d11":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:"选择一个组织进入聊天",visible:e.centerDialogVisible,"show-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"30%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[s("div",[s("el-select",{attrs:{clearable:"",placeholder:"请选择组织"},on:{change:e.currentSel},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.userOrgNoMessageList,(function(t,i){return s("el-option",{attrs:{value:t}},[s("span",{staticStyle:{float:"left"}},[e._v(e._s(t.orgname))]),s("el-badge",{attrs:{value:t.total,max:99}})],1)})),1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.selectOrg()}}},[e._v("确 定")])],1)]),s("div",{staticClass:"message-frame"},[s("div",{staticClass:"message-bar"},[s("div",{staticStyle:{"font-size":"30px","font-weight":"bold",color:"#f5f5f5","margin-left":"10px","margin-top":"10px",width:"250px"}},[e._v(e._s(this.requestData.orgname)+" ")]),s("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",float:"right"},attrs:{title:"点击切换组织"}},[s("el-button",{attrs:{icon:"el-icon-set-up",circle:""},on:{click:e.anewOrg}})],1),s("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center","text-align":"justify",width:"700px","font-weight":"bolder",color:"ivory"}},[s("div",[e._v(" "+e._s(this.requestData.peopleName)+" ")])])]),s("div",{staticClass:"message-window"},[s("div",{staticClass:"message-info-list"},e._l(e.userinfoList,(function(t,i){return s("div",{staticStyle:{cursor:"pointer","background-color":"white"},attrs:{title:"点击聊天"},on:{click:function(s){return e.clickUser(t)}}},[s("div",{staticStyle:{"background-color":"#bababa",height:"2px",width:"250px"}}),s("div",{staticStyle:{display:"flex",width:"250px"}},[s("el-avatar",{staticStyle:{width:"40px"},attrs:{src:t.user.image}}),s("div",{staticStyle:{"margin-left":"8px",width:"100px"}},[s("div",[e._v(e._s(t.user.account))]),s("div",{staticStyle:{width:"100px","font-size":"13px",display:"-webkit-box","-webkit-line-clamp":"1",overflow:"hidden","text-overflow":"ellipsis","-webkit-box-orient":"vertical"}},[e._v(e._s(t.message.content))])]),s("div",{staticStyle:{width:"50px","margin-left":"20px"}},[s("div",{staticStyle:{"font-size":"20px"}},[e._v(e._s(e._f("formatTimer")(t.message.createtime)))]),null!=t.count&&t.count>0?s("el-badge",{staticStyle:{"margin-left":"40px"},attrs:{value:t.count,max:99}}):e._e()],1)],1)])})),0),e.windowsShow?s("div",{staticClass:"message-show-window"},[s("div",{ref:"windowScroll",staticStyle:{height:"380px",width:"706px","background-color":"#ffffff",border:"2px solid #000000","overflow-y":"auto","overflow-x":"hidden"},on:{scroll:function(t){return e.divScrollFn(t)}}},e._l(e.messageList,(function(t,i){return s("div",[t.sendby===e.requestData.member?s("div",{staticClass:"sender",staticStyle:{width:"706px"}},[s("div",[s("img",{staticStyle:{"border-radius":"28px"},attrs:{src:e.requestData.peopleImage}})]),s("div",[s("div",{staticClass:"left_triangle"}),s("span",{staticStyle:{"white-space":"pre-line"}},[e._v(" "+e._s(e._f("lineFeed")(t.content))+" ")])])]):e._e(),t.sendby===e.userid?s("div",{staticClass:"receiver"},[s("div",[s("img",{staticStyle:{"border-radius":"28px"},attrs:{src:e.image}})]),s("div",[s("div",{staticClass:"right_triangle"}),s("span",{staticStyle:{"white-space":"pre-line"}},[e._v(" "+e._s(e._f("lineFeed")(t.content))+" ")])])]):e._e()])})),0),s("div",{staticStyle:{height:"169px",width:"706px","border-bottom-right-radius":"10px","background-color":"white"}},[s("el-input",{staticStyle:{"font-size":"19px"},attrs:{type:"textarea",autosize:{minRows:4,maxRows:4},placeholder:"请输入....",resize:"none",maxlength:"300","show-word-limit":""},model:{value:e.inputMessage,callback:function(t){e.inputMessage=t},expression:"inputMessage"}}),s("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fileRef",attrs:{type:"file"},on:{change:e.fileChange}}),s("el-button",{attrs:{title:"点击发送图片",type:"file",icon:"el-icon-picture-outline",circle:""},on:{click:e.uploadFile}}),s("el-button",{attrs:{type:"warning",icon:"el-icon-document-add",circle:""}}),s("el-button",{attrs:{icon:"el-icon-paperclip",circle:""}}),s("el-button",{staticStyle:{float:"right","margin-right":"10px"},attrs:{title:"发送",type:"success",icon:"el-icon-check",circle:""},on:{click:function(t){return e.sendInformation()}}})],1)]):e._e()])])],1)},n=[],a=s("1da1"),o=s("5530"),r=(s("b0c0"),s("fb6a"),s("96cf"),s("b775")),c=s("0f9a");function l(){return Object(r["a"])({url:"/message/message-info/getOrgCount/"+c["a"].state.userid,method:"get",headers:{"disaster-token":c["a"].state.token}})}function d(e){return Object(r["a"])({url:"/message/message-info/getOneOrgUserInfoMessage/"+e,method:"get",headers:{"disaster-token":c["a"].state.token}})}function u(e){return Object(r["a"])({url:"/message/message-info/getCharRecord/",method:"post",headers:{"disaster-token":c["a"].state.token},data:e})}var g=s("2f62"),h={name:"index",data:function(){return{windowsShow:!1,centerDialogVisible:!0,userOrgNoMessageList:[],value:"",userinfoList:[],requestData:{size:10,current:0,orgname:"",orgid:"",peopleImage:"",peopleName:"",peopleAccount:"",member:""},inputMessage:"",messageList:[],sendMessage:{type:"SEND_TO_ONE_REQUEST",body:{orgId:"",receiveby:"",createtime:"",sendby:"",type:"",content:""}},sendResponse:"SEND_RESPONSE",authResponse:"AUTH_RESPONSE",sendToOneRequest:"SEND_TO_ONE_REQUEST",sendToAllRequest:"SEND_TO_ALL_REQUEST"}},computed:Object(o["a"])({},Object(g["b"])(["image","userid"])),methods:{initWebSocket:function(){this.websock=new WebSocket("ws://localhost:8888/message/information/?disaster-token="+this.$store.getters.token),this.websock.onopen=this.websocketOnOpen,this.websock.onerror=this.websocketOnError,this.websock.onmessage=this.websocketOnMessage,this.websock.onclose=this.websocketClose},websocketOnOpen:function(){console.log("WebSocket连接成功")},websocketOnError:function(e){console.log("WebSocket连接发生错误")},websocketOnMessage:function(e){var t=JSON.parse(e.data);console.log(t),t.type===this.sendToOneRequest?(console.log("一对一收到的消息"+t.body.content),this.messageList.push(t.body),console.log(this.messageList)):t.type===this.sendResponse?200===t.body.code?this.$message({showClose:!0,message:"成功!",type:"warning"}):500===t.body.code&&this.$message({showClose:!0,message:t.body.message,type:"warning"}):t.type===this.authResponse&&(200===t.body.code||500===t.body.code)&&this.$message({showClose:!0,message:t.body.message,type:"warning"})},websocketClose:function(e){this.websock.close(),console.log("销毁连接")},loadingUserOrgNoMessage:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l().then((function(t){var s=t.data;s.status?e.userOrgNoMessageList=s.data:e.$message({showClose:!0,message:s.msg,type:"warning"})}));case 2:case"end":return t.stop()}}),t)})))()},selectOrg:function(){var e=this;this.value?d(this.requestData.orgid).then((function(t){var s=t.data;s.status?(e.userinfoList=s.data,e.centerDialogVisible=!1,e.value=""):e.$message({showClose:!0,message:s.msg,type:"warning"})})).catch((function(e){console.log(e)})):this.$message({showClose:!0,message:"请选择一个聊天组织",type:"warning"})},clickUser:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:t.requestData.peopleImage=e.user.image,t.requestData.peopleName=e.user.name,t.requestData.peopleAccount=e.user.account,t.requestData.member=e.user.id,t.getMessageInfo(t.requestData),t.windowsShow=!0;case 6:case"end":return s.stop()}}),s)})))()},take:function(){var e=this;this.$nextTick((function(){var t=e.$refs.windowScroll;t.scrollTop=t.scrollHeight}))},divScrollFn:function(e){var t=e.target;0==t.scrollTop&&(this.$message({showClose:!0,message:"正在加载更多数据!",type:"warning"}),console.log("到达顶部了!"))},getMessageInfo:function(e){var t=this;u(e).then((function(e){var s=e.data;s.status?t.messageList=s.data.list:t.$message({showClose:!0,message:s.msg,type:"warning"})})).catch((function(e){console.log(e)}))},currentSel:function(e){this.value=e.orgname,this.requestData.orgname=e.orgname,this.requestData.orgid=e.id,console.log(e)},anewOrg:function(){this.centerDialogVisible=!0,this.value="",this.requestData={},this.requestData.size=10,this.requestData.current=0,this.userinfoList=[],this.windowsShow=!1},sendInformation:function(){if(this.inputMessage){this.sendMessage.body.content=this.inputMessage,this.sendMessage.body.type="0",this.sendMessage.body.sendby=this.$store.getters.userid,this.sendMessage.body.orgId=this.requestData.orgid,this.sendMessage.body.receiveby=this.requestData.member;var e={};e.content=this.sendMessage.body.content,e.type=this.sendMessage.body.type,e.sendby=this.sendMessage.body.sendby,e.receiveby=this.sendMessage.body.receiveby,e.createtime=this.sendMessage.body.createtime,this.messageList.push(e),this.websock.send(JSON.stringify(this.sendMessage)),this.inputMessage=""}else this.$message({showClose:!0,message:"不能发送空消息噢!",type:"warning"})},uploadFile:function(){this.$refs.fileRef.dispatchEvent(new MouseEvent("click"))},fileChange:function(){}},updated:function(){this.windowsShow&&this.take()},created:function(){this.loadingUserOrgNoMessage(),this.value="",this.initWebSocket()},mounted:function(){this.windowsShow&&this.take()},filters:{formatTimer:function(e){var t=new Date(e),s=(t.getFullYear(),t.getMonth()+1);s=s<10?"0"+s:s;var i=t.getDate();i=i<10?"0"+i:i;var n=t.getHours();n=n<10?"0"+n:n;var a=t.getMinutes();a=a<10?"0"+a:a;var o=t.getSeconds();return o=o<10?"0"+o:o,n+":"+a},lineFeed:function(e){for(var t=e,s=parseInt(t.length/16),i=1;i<=s;i++){var n=16*i;t=t.slice(0,n)+"\n"+t.slice(n)}return t}},destroyed:function(){this.websocketClose()}},p=h,f=(s("62a0"),s("2877")),m=Object(f["a"])(p,i,n,!1,null,"334d09df",null);t["default"]=m.exports},"62a0":function(e,t,s){"use strict";s("13e5")}}]);