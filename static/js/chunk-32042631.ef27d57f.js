(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-32042631"],{1276:function(t,e,n){"use strict";var a=n("d784"),i=n("44e7"),l=n("825a"),o=n("1d80"),s=n("4840"),c=n("8aa5"),r=n("50c4"),u=n("14c3"),d=n("9263"),h=n("d039"),m=[].push,f=Math.min,p=4294967295,g=!h((function(){return!RegExp(p,"y")}));a("split",2,(function(t,e,n){var a;return a="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,n){var a=String(o(this)),l=void 0===n?p:n>>>0;if(0===l)return[];if(void 0===t)return[a];if(!i(t))return e.call(a,t,l);var s,c,r,u=[],h=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),f=0,g=new RegExp(t.source,h+"g");while(s=d.call(g,a)){if(c=g.lastIndex,c>f&&(u.push(a.slice(f,s.index)),s.length>1&&s.index<a.length&&m.apply(u,s.slice(1)),r=s[0].length,f=c,u.length>=l))break;g.lastIndex===s.index&&g.lastIndex++}return f===a.length?!r&&g.test("")||u.push(""):u.push(a.slice(f)),u.length>l?u.slice(0,l):u}:"0".split(void 0,0).length?function(t,n){return void 0===t&&0===n?[]:e.call(this,t,n)}:e,[function(e,n){var i=o(this),l=void 0==e?void 0:e[t];return void 0!==l?l.call(e,i,n):a.call(String(i),e,n)},function(t,i){var o=n(a,t,this,i,a!==e);if(o.done)return o.value;var d=l(t),h=String(this),m=s(d,RegExp),b=d.unicode,y=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(g?"y":"g"),v=new m(g?d:"^(?:"+d.source+")",y),x=void 0===i?p:i>>>0;if(0===x)return[];if(0===h.length)return null===u(v,h)?[h]:[];var D=0,k=0,w=[];while(k<h.length){v.lastIndex=g?k:0;var V,_=u(v,g?h:h.slice(k));if(null===_||(V=f(r(v.lastIndex+(g?0:k)),h.length))===D)k=c(h,k,b);else{if(w.push(h.slice(D,k)),w.length===x)return w;for(var C=1;C<=_.length-1;C++)if(w.push(_[C]),w.length===x)return w;k=D=V}}return w.push(h.slice(D)),w}]}),!g)},"330b":function(t,e,n){"use strict";n("8dfc")},"614e":function(t,e,n){},"8dfc":function(t,e,n){},c740:function(t,e,n){"use strict";var a=n("23e7"),i=n("b727").findIndex,l=n("44d2"),o=n("ae40"),s="findIndex",c=!0,r=o(s);s in[]&&Array(1)[s]((function(){c=!1})),a({target:"Array",proto:!0,forced:c||!r},{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),l(s)},cd61:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{attrs:{"close-on-press-escape":!1,"before-close":t.exitDialog,title:t.title+"表分析数据",fullscreen:"",visible:t.dialogAnalyseVisible},on:{close:t.closeWindow,"update:visible":function(e){t.dialogAnalyseVisible=e}}},[n("div",{staticClass:"usable-content"},[n("div",{staticClass:"itxst"},[n("div",{staticClass:"col"},[n("div",{staticStyle:{"margin-left":"12px","margin-bottom":"10px"}},[n("b",[t._v("可选字段")])]),n("draggable",{attrs:{options:{group:{name:"itxst",pull:"clone"},sort:!1},animation:"300",move:t.onMove},on:{end:t.end},model:{value:t.filedData,callback:function(e){t.filedData=e},expression:"filedData"}},t._l(t.filedData,(function(e){return n("div",{key:e.id,staticClass:"item"},[n("el-tooltip",{attrs:{placement:"top"}},[n("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.comment))]),n("b",[t._v(t._s(e.columnName))])])],1)})),0)],1),n("div",{staticStyle:{"margin-left":"5px"}},[n("div",{staticClass:"row"},[n("div",{staticStyle:{"margin-top":"8px","margin-left":"5px"}},[n("b",[t._v("X轴")])]),n("draggable",{staticStyle:{display:"flex","min-width":"90px","min-height":"30px"},attrs:{options:{group:{name:"itxst",pull:""},sort:!0},animation:"300"},model:{value:t.rowData,callback:function(e){t.rowData=e},expression:"rowData"}},[t._l(t.rowData,(function(e,a){return n("div",{key:e.id,staticClass:"item2",on:{click:function(n){return t.rowContextmenu(n,e.columnName,a)}}},[t._v(" "+t._s(e.columnName)+" ")])})),t.menuVisible?n("Menus",{ref:"contextbutton",attrs:{"button-name1":"格式化时间"},on:{foo:t.foo,handleOne:t.handleOne,handleTwo:t.handleTwo,handleThree:t.handleThree}}):t._e()],2)],1),n("div",{staticStyle:{display:"flex"}},[n("div",{staticClass:"col1"},[n("b",{staticStyle:{"margin-left":"10px"}},[t._v("Y轴")]),n("draggable",{staticStyle:{"min-height":"60px"},attrs:{options:{group:{name:"itxst",pull:""},sort:!1},animation:"300"},model:{value:t.colData,callback:function(e){t.colData=e},expression:"colData"}},[t._l(t.colData,(function(e,a){return n("div",{key:e.id,staticClass:"item2",on:{click:function(n){return t.colContextmenu(n,e.columnName,a)}}},[t._v(" "+t._s(e.columnName)+" ")])})),t.colMenuVisible?n("Menus",{ref:"colContextbutton",on:{foo:t.colFoo,handleOne:t.colHandleOne,handleTwo:t.colHandleTwo,handleThree:t.colHandleThree}}):t._e()],2)],1),n("div",{staticClass:"analyse-content"},[n("div",[n("el-button",{staticStyle:{"margin-right":"5px",float:"right"},attrs:{title:"保存",type:"success",icon:"el-icon-check",circle:""},on:{click:t.saveAnalyseData}}),n("el-button",{staticStyle:{"margin-right":"5px",float:"right"},attrs:{title:"全部清除",type:"danger",icon:"el-icon-delete",circle:""},on:{click:t.clearSelectInfo}}),n("el-button",{attrs:{title:"点击分析",type:"warning",icon:"el-icon-s-marketing",circle:""},on:{click:t.startAnalyse}}),n("el-dialog",{attrs:{title:"字段绑定聚合函数",visible:t.funcDialogVisible,width:"20%","show-close":!1,modal:!1},on:{"update:visible":function(e){t.funcDialogVisible=e}}},[n("el-select",{attrs:{placeholder:"请选择函数"},model:{value:t.selectFunc,callback:function(e){t.selectFunc=e},expression:"selectFunc"}},t._l(t.options,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value,disabled:t.disabled}})})),1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.funcDialogVisible=!1,t.selectFunc=""}}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:t.okSelectFunc}},[t._v("确 定")])],1)],1),n("el-dialog",{attrs:{title:"绑定时间格式化",visible:t.formatDialogVisible,width:"20%","show-close":!1,modal:!1},on:{"update:visible":function(e){t.formatDialogVisible=e}}},[n("el-select",{attrs:{placeholder:"请选择格式"},model:{value:t.selectFormat,callback:function(e){t.selectFormat=e},expression:"selectFormat"}},t._l(t.optionsFormat,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value,disabled:t.disabled}})})),1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.formatDialogVisible=!1,t.selectFormat=""}}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:t.okSelectFormat}},[t._v("确 定")])],1)],1),n("el-dialog",{attrs:{title:"请输入分析图名称",visible:t.nameDialogVisible,width:"20%","show-close":!1,modal:!1},on:{"update:visible":function(e){t.nameDialogVisible=e}}},[n("el-input",{attrs:{placeholder:"请输入保存名称",clearable:""},model:{value:t.inputName,callback:function(e){t.inputName=e},expression:"inputName"}}),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:t.okInputName}},[t._v("确 定")])],1)],1),n("div",[n("div",[n("div",{ref:"chart",staticStyle:{width:"900px",height:"490px","margin-left":"60px"}})])])],1)])])])])])])},i=[],l=(n("159b"),n("c740"),n("a434"),n("ac1f"),n("1276"),n("b64b"),n("b76a")),o=n.n(l),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"contextmenu",attrs:{id:"contextmenu"}},[n("div",{staticClass:"contextmenu__item",on:{click:function(e){return t.handleOne()}}},[t._v(t._s(t.buttonName1))]),n("div",{staticClass:"contextmenu__item2",on:{click:function(e){return t.handleTwo()}}},[t._v(t._s(t.buttonName2))]),n("div",{staticClass:"contextmenu__item3",on:{click:function(e){return t.handleThree()}}},[t._v(t._s(t.buttonName3))])])},c=[],r={name:"index",data:function(){return{}},props:{buttonName1:{type:String,default:function(){return"绑定函数"}},buttonName2:{type:String,default:function(){return"取消"}},buttonName3:{type:String,default:function(){return"删除"}}},methods:{init:function(t){var e=document.querySelector("#contextmenu"),n=document.body.clientHeight-t.clientY;console.log(document.body.clientHeight,t.clientY,n),e.style.top=n<150?t.clientY-120+"px":t.clientY-10+"px",e.style.left=t.clientX+10+"px",document.addEventListener("click",this.foo)},foo:function(){this.$emit("foo")},handleOne:function(){this.$emit("handleOne")},handleTwo:function(){this.$emit("handleTwo")},handleThree:function(){this.$emit("handleThree")}}},u=r,d=(n("d1f5"),n("2877")),h=Object(d["a"])(u,s,c,!1,null,"ad6e53a4",null),m=h.exports,f=n("f076"),p={name:"createAnalyse",components:{draggable:o.a,Menus:m},props:{filedData:{type:Array,deafult:function(){return[]}}},data:function(){return{dialogAnalyseVisible:!1,title:"",rowData:[],menuVisible:!1,colData:[],clickRowIndex:0,clickRowValue:"",clickColIndex:0,clickColValue:"",colMenuVisible:!1,toAnalyse:{tableName:"",fields:[],param:{analyseFiled:{filed:"",code:""},fieldInfo:{filed:"",format:""}}},funcDialogVisible:!1,options:[{value:"max()",label:"最大值"},{value:"min()",label:"最小值"},{value:"avg()",label:"平均值"},{value:"count()",label:"统计"},{value:"sum()",label:"求和"}],formatDialogVisible:!1,optionsFormat:[{value:"%Y-%m-%d",label:"YYYY-mm-dd"},{value:"%Y",label:"YYYY"},{value:"%Y-%m",label:"YYYY-mm"},{value:"%y",label:"yy"},{value:"%W",label:"周"}],selectFormat:"",selectFunc:"",xData:[],yData:[],resultSQL:"",nameDialogVisible:!1,inputName:"",isSave:!1}},methods:{init:function(t){this.title=t,this.dialogAnalyseVisible=!0},end:function(t){var e=[];"row"===t.to.parentElement.className?(this.rowData.forEach((function(t,n){e.push({id:n,columnName:t.columnName,comment:t.comment})})),this.rowData=e):"col1"===t.to.parentElement.className&&(this.colData.forEach((function(t,n){e.push({id:n,columnName:t.columnName,comment:t.comment})})),this.colData=e)},onMove:function(t){var e=this.rowData.findIndex((function(e){return e.columnName===t.draggedContext.element.columnName})),n=this.colData.findIndex((function(e){return e.columnName===t.draggedContext.element.columnName}));return-1===e&&-1===n},colContextmenu:function(t,e,n){var a=this;this.clickCOlValue=e,this.clickColIndex=n,this.colMenuVisible=!1,this.colMenuVisible=!0,t.preventDefault(),this.$nextTick((function(){a.$refs.colContextbutton.init(t)}))},colFoo:function(){this.colMenuVisible=!0,document.removeEventListener("click",this.foo)},colHandleOne:function(){this.colMenuVisible=!1,this.funcDialogVisible=!0,console.log("点击菜单一")},colHandleTwo:function(){this.colMenuVisible=!1,console.log("点击菜单二")},colHandleThree:function(){this.colData.splice(this.clickColIndex,1),this.toAnalyse.param.analyseFiled.code="",this.toAnalyse.param.analyseFiled.filed="",this.yData=[],this.colMenuVisible=!1,console.log("点击菜单三")},rowContextmenu:function(t,e,n){var a=this;this.clickRowValue=e,this.clickRowIndex=n,this.menuVisible=!1,this.menuVisible=!0,t.preventDefault(),this.$nextTick((function(){a.$refs.contextbutton.init(t)}))},foo:function(){this.menuVisible=!0,document.removeEventListener("click",this.foo)},handleOne:function(){"createtime"===this.clickRowValue||"updatetime"===this.clickRowValue?this.formatDialogVisible=!0:this.$message({message:"此字段非时间类型无法格式化!",type:"warning"}),this.menuVisible=!1,console.log("点击菜单一")},handleTwo:function(){this.menuVisible=!1,console.log("点击菜单二")},handleThree:function(){this.rowData.splice(this.clickRowIndex,1),this.toAnalyse.param.fieldInfo.filed="",this.toAnalyse.param.fieldInfo.format="",this.xData=[],this.menuVisible=!1,console.log("点击菜单三")},initCharts:function(){var t=this.$echarts.init(this.$refs.chart);t.setOption({xAxis:{type:"category",name:this.rowData[0].comment,data:this.xData},yAxis:{name:this.colData[0].comment},series:[{data:this.yData,type:"line"}]},!0)},clearSelectInfo:function(){this.colData=[],this.rowData=[],this.toAnalyse.tableName="",this.toAnalyse.param.fieldInfo.filed="",this.toAnalyse.param.fieldInfo.format="",this.toAnalyse.param.analyseFiled.code="",this.toAnalyse.param.analyseFiled.filed="",this.yData=[],this.xData=[],this.inputName=""},saveAnalyseData:function(){this.resultSQL?this.nameDialogVisible=!0:this.$message({message:"无可保存的分析数据!",type:"warning"})},okInputName:function(){var t=this;if(this.inputName){var e={sqldata:this.resultSQL,name:this.inputName,tablename:this.title};Object(f["d"])(e).then((function(e){var n=e.data;n.status?(t.$message({message:n.msg,type:"success"}),t.isSave=!0,t.nameDialogVisible=!1):t.$notify.error({title:n.msg,message:n.msg})})).catch((function(t){console.log(t)}))}else this.$message({message:"名称不能为空!",type:"warning"})},okSelectFunc:function(){var t=this.colData[this.clickColIndex].columnName.split("-");t[1]?this.colData[this.clickColIndex].columnName=t[0]+"-"+this.selectFunc:this.colData[this.clickColIndex].columnName+="-"+this.selectFunc,this.selectFunc="",this.funcDialogVisible=!1},okSelectFormat:function(){this.toAnalyse.param.fieldInfo.filed=this.clickRowValue,this.toAnalyse.param.fieldInfo.format=this.selectFormat,this.selectFormat="",this.formatDialogVisible=!1},startAnalyse:function(){var t=this;if(this.yData=[],this.xData=[],this.rowData.length>0&&this.colData.length>0){var e=this.colData[0].columnName.split("-");e[1]?(this.toAnalyse.param.fieldInfo.filed=this.rowData[0].columnName,this.toAnalyse.param.analyseFiled.filed=e[0],this.toAnalyse.param.analyseFiled.code=e[1],this.toAnalyse.tableName=this.title,console.log(this.toAnalyse),Object(f["h"])(this.toAnalyse).then((function(e){var n=e.data;if(n.status){t.resultSQL=n.data.sql;var a=n.data.result;a.forEach((function(e,n){var a=Object.keys(e);t.xData.push(e[a[0]]),t.yData.push(e[a[1]])})),t.initCharts()}else t.$notify.error({title:"分析异常!",message:n.msg})})).catch((function(t){console.log(t)}))):this.$message({message:"请配置Y轴函数!",type:"warning"})}else this.$message({message:"请拖拽数据到X/Y轴!",type:"warning"})},exitDialog:function(){var t=this;!this.isSave&&this.resultSQL?this.$confirm("检测到未保存的内容，是否在离开页面前保存修改？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"保存",cancelButtonText:"放弃修改"}).then((function(){t.saveAnalyseData()})).catch((function(e){"cancel"===e&&(t.clearSelectInfo(),t.$echarts.init(t.$refs.chart).clear(),t.dialogAnalyseVisible=!1),t.$message({type:"info",message:"cancel"===e?"放弃保存并离开页面":"停留在当前页面"})})):(this.clearSelectInfo(),this.$echarts.init(this.$refs.chart).clear(),this.dialogAnalyseVisible=!1)},closeWindow:function(){this.$parent.getAnalyseDataList()}},mounted:function(){},created:function(){var t=this;this.filedData.forEach((function(e,n){t.$set(e,"id",n)})),document.body.ondrop=function(t){t.preventDefault(),t.stopPropagation()}},updated:function(){}},g=p,b=(n("330b"),Object(d["a"])(g,a,i,!1,null,"8b5f4332",null));e["default"]=b.exports},d1f5:function(t,e,n){"use strict";n("614e")},f076:function(t,e,n){"use strict";n.d(e,"g",(function(){return l})),n.d(e,"e",(function(){return o})),n.d(e,"f",(function(){return s})),n.d(e,"h",(function(){return c})),n.d(e,"d",(function(){return r})),n.d(e,"b",(function(){return u})),n.d(e,"a",(function(){return d})),n.d(e,"c",(function(){return h}));var a=n("b775"),i=n("0f9a");function l(t){return Object(a["a"])({url:"/analyse/analyse-mysql/showTables",method:"post",headers:{"disaster-token":i["a"].state.token},data:t})}function o(t){return Object(a["a"])({url:"/analyse/analyse-mysql/showTableFiled/"+t,method:"get",headers:{"disaster-token":i["a"].state.token}})}function s(t){return Object(a["a"])({url:"/analyse/analyse-mysql/getData/"+t,method:"get",headers:{"disaster-token":i["a"].state.token}})}function c(t){return Object(a["a"])({url:"/analyse/analyse-mysql/analyseData/",method:"post",headers:{"disaster-token":i["a"].state.token},data:t})}function r(t){return Object(a["a"])({url:"/analyse/analyse-record/insert/",method:"post",headers:{"disaster-token":i["a"].state.token},data:t})}function u(t){return Object(a["a"])({url:"/analyse/analyse-record/list/",method:"post",headers:{"disaster-token":i["a"].state.token},data:t})}function d(t){return Object(a["a"])({url:"/analyse/analyse-record/delete/"+t,method:"get",headers:{"disaster-token":i["a"].state.token}})}function h(t){return Object(a["a"])({url:"/analyse/analyse-mysql/getRecordData/",method:"post",headers:{"disaster-token":i["a"].state.token},data:t})}}}]);